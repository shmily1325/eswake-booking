# ESWake 預約系統 - 離線編輯器使用說明

## 📋 概述

這是一個完全離線運行的 HTML 編輯器，可以在瀏覽器中直接編輯和管理 ESWake 預約系統的資料庫。當 Supabase 或 Vercel 出現問題時，可以使用此工具進行緊急資料編輯和修改。

## 🚀 功能特點

- ✅ **完全離線運行** - 不需要網路連線，所有資料都在瀏覽器本地處理
- ✅ **載入 SQL 備份** - 支援載入 PostgreSQL 備份 SQL 檔案
- ✅ **資料庫管理** - 完整的 CRUD 操作（新增、編輯、刪除、查詢）
- ✅ **多種匯出格式** - 可匯出為 SQL 格式或 SQLite 格式
- ✅ **主要功能模組**：
  - 📅 預約管理
  - 👥 會員管理
  - 🏋️ 教練管理
  - 🚤 船隻管理
  - 💰 交易記錄查詢
  - 📊 教練回報查詢

## 📖 使用步驟

### 1. 開啟離線編輯器

直接在瀏覽器中開啟 `offline-editor.html` 檔案。

### 2. 載入資料庫

有兩種方式載入資料庫：

#### 方式一：載入 SQL 備份檔案（推薦）

1. 點擊「📁 載入 SQL 備份」按鈕
2. 選擇你的 PostgreSQL 備份 SQL 檔案
3. 系統會自動轉換並載入資料

**注意事項：**
- 支援 PostgreSQL 備份 SQL 格式
- 會自動跳過不支援的語句（如 RLS 政策、觸發器等）
- 載入完成後會顯示成功和跳過的語句數量

#### 方式二：建立空白資料庫

1. 點擊「🆕 建立空白資料庫」按鈕
2. 系統會建立空的資料庫結構
3. 可以開始手動新增資料

### 3. 編輯資料

#### 預約管理
- 點擊「📅 預約」標籤
- 使用搜尋框快速找到特定預約
- 點擊「➕ 新增預約」建立新預約
- 點擊「編輯」修改現有預約
- 點擊「刪除」移除預約

#### 會員管理
- 點擊「👥 會員」標籤
- 可以新增、編輯、刪除會員
- 管理會員的財務資訊（餘額、時數、船券）

#### 教練管理
- 點擊「🏋️ 教練」標籤
- 管理教練基本資料和狀態

#### 船隻管理
- 點擊「🚤 船隻」標籤
- 管理船隻名稱、顏色和啟用狀態

### 4. 匯出資料

完成編輯後，可以匯出資料：

#### 匯出為 SQL 格式（推薦）
- 點擊「📄 匯出為 SQL」按鈕
- 會產生包含所有資料的 SQL INSERT 語句
- 可以直接在 PostgreSQL 中執行

#### 匯出為 SQLite 格式
- 點擊「💾 匯出資料庫」按鈕
- 選擇 SQLite 格式
- 會產生二進位 SQLite 資料庫檔案

## 🔧 技術細節

### 資料庫引擎
- 使用 **SQL.js** 在瀏覽器中運行 SQLite
- 所有資料都儲存在瀏覽器記憶體中
- 關閉瀏覽器前請務必匯出資料！

### PostgreSQL 到 SQLite 轉換
系統會自動轉換以下語法：
- `SERIAL` → `INTEGER`
- `DECIMAL` → `REAL`
- `BOOLEAN` → `INTEGER`
- `TIMESTAMPTZ` → `TEXT`
- `gen_random_uuid()` → SQLite UUID 函數
- `TRUE/FALSE` → `1/0`
- 陣列類型 → `TEXT`

### 支援的資料表
- `members` - 會員表
- `boats` - 船隻表
- `coaches` - 教練表
- `bookings` - 預約表
- `booking_members` - 預約會員關聯表
- `booking_coaches` - 預約教練關聯表
- `coach_reports` - 教練回報表
- `booking_participants` - 預約參與者表
- `transactions` - 交易記錄表

## ⚠️ 重要提醒

1. **資料儲存位置**
   - 所有資料都儲存在瀏覽器記憶體中
   - **關閉瀏覽器或重新整理頁面會遺失所有未匯出的資料**
   - 請定期匯出資料作為備份

2. **瀏覽器相容性**
   - 建議使用 Chrome、Firefox、Edge 等現代瀏覽器
   - 需要支援 WebAssembly（SQL.js 依賴）

3. **SQL 備份檔案**
   - 建議使用從 Supabase 匯出的完整備份
   - 大型檔案可能需要較長載入時間
   - 載入過程中請勿關閉頁面

4. **資料完整性**
   - 外鍵約束會自動處理
   - 刪除記錄時會自動處理關聯資料（CASCADE）
   - 建議在重要操作前先匯出備份

## 🆘 疑難排解

### 問題：無法載入 SQL 檔案
- **解決方案**：檢查 SQL 檔案格式是否正確，確保是 UTF-8 編碼

### 問題：載入後資料不完整
- **解決方案**：某些 PostgreSQL 專用語法可能無法轉換，這是正常現象。可以手動新增缺失的資料。

### 問題：匯出失敗
- **解決方案**：確保瀏覽器允許下載檔案，檢查瀏覽器下載設定

### 問題：頁面重新整理後資料消失
- **解決方案**：這是正常行為，所有資料都在記憶體中。請記得在關閉前匯出資料。

## 📝 使用範例

### 範例 1：從備份恢復並修改預約

1. 開啟 `offline-editor.html`
2. 載入你的 SQL 備份檔案
3. 切換到「📅 預約」標籤
4. 找到需要修改的預約，點擊「編輯」
5. 修改後點擊「儲存」
6. 匯出為 SQL 格式
7. 在 Supabase SQL Editor 中執行匯出的 SQL

### 範例 2：建立新會員

1. 載入資料庫（或建立空白資料庫）
2. 切換到「👥 會員」標籤
3. 點擊「➕ 新增會員」
4. 填寫會員資料
5. 點擊「儲存」
6. 匯出資料庫

## 🔄 與 Supabase 同步

匯出的 SQL 檔案可以在 Supabase 中執行：

1. 登入 Supabase Dashboard
2. 前往 SQL Editor
3. 貼上匯出的 SQL 內容
4. 執行 SQL（注意：可能需要先清空現有資料或使用 `ON CONFLICT` 處理）

## 📞 支援

如有問題或建議，請聯繫開發團隊。

---

**版本：** 1.0.0  
**最後更新：** 2025-01-XX

