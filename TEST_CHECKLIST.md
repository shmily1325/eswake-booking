# 📋 預約系統測試檢查清單

## 🎯 核心功能測試

### 1️⃣ 船隻預約衝突檢查
- [ ] **時間重疊** - 預約A: 10:00-11:00，預約B: 10:30-11:30 → 應該衝突
- [ ] **接船時間衝突** - 預約A: 10:00-11:00 結束，預約B: 11:10 開始 → 應該衝突（需15分鐘）
- [ ] **緊接預約** - 預約A: 10:00-11:00，預約B: 11:15 開始 → 應該成功
- [ ] **同時開始** - 兩個預約同一船同一時間 → 應該衝突
- [ ] **包含關係** - 預約A: 10:00-12:00，預約B: 10:30-11:00 → 應該衝突

### 2️⃣ 教練衝突檢查
- [ ] 教練A在船1有預約10:00-11:00，在船2同時段被指派 → 應該衝突
- [ ] 教練A在10:00-11:00有預約，10:30-11:30被指派 → 應該衝突
- [ ] 教練A在10:00-11:00有預約，11:15被指派 → 應該成功
- [ ] 多個教練同時被指派，其中一個衝突 → 應該顯示具體哪位教練衝突
- [ ] 不指定教練的預約 → 應該總是成功（除非船隻衝突）

### 3️⃣ 08:00 前預約規則
- [ ] 07:30 預約，未指定教練 → 應該阻止並顯示錯誤
- [ ] 07:30 預約，已指定教練 → 應該成功
- [ ] 08:00 預約，未指定教練 → 應該成功
- [ ] 04:30 預約（最早時段），未指定教練 → 應該阻止

### 4️⃣ 重複預約功能
- [ ] **基本重複** - 每週同一時間，重複8次 → 應該創建8筆預約
- [ ] **部分衝突** - 重複預約中第3週衝突 → 應該跳過第3週，其他週正常創建
- [ ] **結束日期模式** - 使用結束日期而非次數 → 應該正確計算週數
- [ ] **跨月重複** - 從月底開始重複到下月 → 日期計算正確
- [ ] **衝突訊息** - 顯示哪些日期成功，哪些被跳過及原因

### 5️⃣ 多會員支援
- [ ] 選擇1位會員 → contact_name 正確
- [ ] 選擇3位會員 → contact_name 為 "會員1, 會員2, 會員3"
- [ ] 選擇會員 + 手動輸入 → contact_name 為 "會員1, 非會員1"
- [ ] 只手動輸入 → contact_name 為 "非會員1"
- [ ] 編輯時正確載入已選會員和手動名字
- [ ] booking_members 表正確插入所有會員關聯

### 6️⃣ 時間處理（關鍵！）
- [ ] **時區一致性** - 選擇 14:00 儲存和顯示都是 14:00（不會變成 22:00）
- [ ] **跨日預約** - 23:00 開始，120分鐘 → 結束時間顯示 01:00
- [ ] **15分鐘間隔** - 時間選擇器只能選 :00, :15, :30, :45
- [ ] **日期切換** - 切換日期時預約正確更新
- [ ] **今天按鈕** - 點擊後正確跳轉到今天

### 7️⃣ UI/UX 測試
- [ ] **手機版** - 單船模式切換正常
- [ ] **列表/時間軸切換** - 兩種視圖數據一致
- [ ] **對話框** - 新增/編輯對話框關閉後狀態正確重置
- [ ] **Loading狀態** - 提交時按鈕正確顯示"處理中..."
- [ ] **錯誤訊息** - 衝突時錯誤訊息清晰易懂
- [ ] **會員搜尋** - 輸入時下拉選單正確過濾

### 8️⃣ 編輯功能
- [ ] **修改時間** - 編輯預約改時間，衝突檢查正確（排除自己）
- [ ] **更換船隻** - 換船時檢查新船的衝突
- [ ] **更換教練** - 換教練時檢查新教練的衝突
- [ ] **刪除預約** - 刪除後時間軸正確更新
- [ ] **審計日誌** - 所有變更正確記錄

### 9️⃣ 邊界情況
- [ ] **同一分鐘** - 兩個預約在同一分鐘開始
- [ ] **最短時長** - 30分鐘預約
- [ ] **最長時長** - 300分鐘（5小時）預約
- [ ] **最早時段** - 04:30 預約
- [ ] **最晚時段** - 21:45 預約
- [ ] **彈簧床** - 彈簧床沒有清理時間（特殊規則）

### 🔟 性能測試
- [ ] 當天有20+筆預約時切換日期的速度
- [ ] 重複創建50週預約的處理時間
- [ ] 會員列表有100+會員時搜尋速度
- [ ] 多個教練同時被檢查衝突的速度

---

## 🐛 已知常見Bug模式

### 時區相關
```
症狀：選擇 14:00，儲存後變成 22:00 或其他時間
原因：使用了 new Date('2025-11-09T14:00') 會套用時區
解決：已使用純字串處理，但要確認所有地方都一致
```

### 衝突檢查漏洞
```
症狀：明明時間重疊卻沒有阻止
原因：比較邏輯錯誤或漏掉某種情況
檢查：NewBookingDialog.tsx line 336-343 和 EditBookingDialog.tsx line 308-314
```

### 教練衝突未檢測
```
症狀：教練在兩個地方同時被指派
原因：可能是 booking_coaches 關聯表查詢錯誤
檢查：NewBookingDialog.tsx line 346-419
```

### 會員關聯遺失
```
症狀：選了多位會員但只記錄一位
原因：booking_members 表插入失敗但沒有阻止流程
檢查：NewBookingDialog.tsx line 488-504
```

---

## 🧪 快速測試場景

### 場景1: 基本衝突
1. 創建預約：G23, 2025-11-10, 10:00-11:00, 學生A
2. 嘗試創建：G23, 2025-11-10, 10:30-11:30, 學生B
3. ✅ 預期：顯示時間重疊錯誤

### 場景2: 接船時間
1. 創建預約：G23, 2025-11-10, 10:00-11:00, 學生A
2. 嘗試創建：G23, 2025-11-10, 11:10-12:00, 學生B
3. ✅ 預期：顯示需要15分鐘接船時間錯誤

### 場景3: 教練衝突
1. 創建預約：G23, 2025-11-10, 10:00-11:00, 學生A, 教練王
2. 嘗試創建：G21, 2025-11-10, 10:30-11:30, 學生B, 教練王
3. ✅ 預期：顯示教練王衝突錯誤

### 場景4: 重複預約部分衝突
1. 創建預約：G23, 2025-11-10, 10:00-11:00, 學生A
2. 創建重複：G23, 2025-11-10, 10:30-11:30, 學生B, 重複4週
3. ✅ 預期：第1週被跳過（衝突），第2-4週成功，顯示報告

### 場景5: 多會員
1. 創建預約，選擇會員A、會員B、手動輸入"訪客C"
2. 檢查資料庫：
   - bookings.contact_name = "會員A姓名, 會員B姓名, 訪客C"
   - booking_members 有2筆（會員A和B）
3. 編輯該預約，確認會員和訪客都正確顯示

---

## 🔍 測試工具使用

使用 `TEST_HELPER.html` 進行快速測試：
1. 在瀏覽器打開 TEST_HELPER.html
2. 選擇測試場景
3. 自動生成測試數據
4. 一鍵清理測試數據

---

## 📊 測試進度追蹤

日期: ___________
測試人員: ___________

通過: ___ / 總共測試: ___

主要問題:
1. 
2. 
3. 

優先修復:
- [ ] 
- [ ] 
- [ ] 

